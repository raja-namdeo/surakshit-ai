/**
 * Scan Profiles
 * Defines different scanning profiles and configurations for various project types
 */

// Default scan parameters
const defaultScanParams = {
  threshold: 'medium', // Minimum severity level to report (low, medium, high, critical)
  maxDuration: 60, // Maximum scan duration in minutes
  maxDepth: 5, // Maximum crawl depth
  includePassive: true, // Include passive scanning
  includeActive: true, // Include active scanning
  spiderScanMaxDuration: 10, // Maximum spider scan duration in minutes
  ajaxSpider: false, // Whether to use the AJAX spider
  apiScan: false, // Whether to perform API scanning
};

// Scan profiles for different project types
const scanProfiles = {
  // Web application profile
  webApp: {
    name: 'Web Application',
    description: 'Comprehensive scan for web applications',
    params: {
      ...defaultScanParams,
      ajaxSpider: true,
      scanners: [
        'xss', 'sqli', 'csrf', 'xxe', 'path-traversal', 'remote-file-inclusion',
        'server-side-includes', 'script-active', 'server-side-code-injection',
        'external-redirect', 'crlf-injection', 'parameter-tampering', 'hidden-file-finder',
        'path-traversal', 'remote-file-include', 'buffer-overflow', 'format-string',
        'parameter-pollution', 'session-fixation', 'cross-domain-js', 'padding-oracle',
        'user-agent-fuzzer', 'shell-shock', 'insecure-http-methods', 'ldap-injection'
      ],
      excludeUrls: [
        '\\.(gif|jpg|png|jpeg|css|js|ico|svg|woff|woff2|ttf|eot)$'
      ]
    }
  },
  
  // API profile
  api: {
    name: 'API',
    description: 'Focused scan for REST APIs',
    params: {
      ...defaultScanParams,
      apiScan: true,
      ajaxSpider: false,
      maxDepth: 10,
      scanners: [
        'sqli', 'xxe', 'path-traversal', 'remote-file-inclusion',
        'server-side-code-injection', 'parameter-tampering', 'ldap-injection',
        'script-active', 'server-side-includes', 'external-redirect',
        'parameter-pollution'
      ],
      excludeUrls: []
    }
  },
  
  // Mobile backend profile
  mobileBackend: {
    name: 'Mobile Backend',
    description: 'Security scan for mobile app backends',
    params: {
      ...defaultScanParams,
      apiScan: true,
      maxDepth: 8,
      scanners: [
        'sqli', 'xxe', 'path-traversal', 'remote-file-inclusion',
        'server-side-code-injection', 'parameter-tampering', 'ldap-injection',
        'script-active', 'server-side-includes', 'external-redirect',
        'parameter-pollution', 'jwt-scanner'
      ],
      excludeUrls: []
    }
  },
  
  // E-commerce profile
  ecommerce: {
    name: 'E-commerce',
    description: 'Specialized scan for e-commerce applications',
    params: {
      ...defaultScanParams,
      ajaxSpider: true,
      maxDuration: 90, // Longer scan for e-commerce sites
      scanners: [
        'xss', 'sqli', 'csrf', 'xxe', 'path-traversal', 'remote-file-inclusion',
        'server-side-includes', 'script-active', 'server-side-code-injection',
        'external-redirect', 'crlf-injection', 'parameter-tampering', 'hidden-file-finder',
        'path-traversal', 'remote-file-include', 'buffer-overflow', 'format-string',
        'parameter-pollution', 'session-fixation', 'cross-domain-js', 'padding-oracle',
        'user-agent-fuzzer', 'shell-shock', 'insecure-http-methods', 'ldap-injection',
        'insecure-http-methods', 'cookie-slack-detector', 'cookie-loose-scope'
      ],
      excludeUrls: [
        '\\.(gif|jpg|png|jpeg|css|ico|svg|woff|woff2|ttf|eot)$',
        '\\.(pdf|zip|tar|gz|doc|docx|xls|xlsx|ppt|pptx)$'
      ]
    }
  },
  
  // Quick scan profile
  quick: {
    name: 'Quick Scan',
    description: 'Fast scan with limited scope',
    params: {
      ...defaultScanParams,
      maxDuration: 15,
      maxDepth: 3,
      includeActive: false, // Only passive scanning for quick scans
      scanners: [
        'xss', 'sqli', 'csrf', 'xxe'
      ],
      excludeUrls: [
        '\\.(gif|jpg|png|jpeg|css|js|ico|svg|woff|woff2|ttf|eot)$',
        '\\.(pdf|zip|tar|gz|doc|docx|xls|xlsx|ppt|pptx)$'
      ]
    }
  },
  
  // Thorough scan profile
  thorough: {
    name: 'Thorough Scan',
    description: 'Comprehensive scan with all available scanners',
    params: {
      ...defaultScanParams,
      maxDuration: 120,
      maxDepth: 10,
      ajaxSpider: true,
      apiScan: true,
      spiderScanMaxDuration: 20,
      scanners: 'all', // Use all available scanners
      excludeUrls: [
        '\\.(gif|jpg|png|jpeg|css|ico|svg|woff|woff2|ttf|eot)$'
      ]
    }
  }
};

// Function to get scan profile by name
const getScanProfile = (profileName) => {
  return scanProfiles[profileName] || scanProfiles.quick; // Default to quick scan if profile not found
};

// Function to get all available scan profiles
const getAllScanProfiles = () => {
  return Object.keys(scanProfiles).map(key => ({
    id: key,
    name: scanProfiles[key].name,
    description: scanProfiles[key].description
  }));
};

// Function to merge custom parameters with a profile
const customizeScanProfile = (profileName, customParams) => {
  const profile = getScanProfile(profileName);
  return {
    ...profile,
    params: {
      ...profile.params,
      ...customParams
    }
  };
};

module.exports = {
  getScanProfile,
  getAllScanProfiles,
  customizeScanProfile,
  defaultScanParams
};