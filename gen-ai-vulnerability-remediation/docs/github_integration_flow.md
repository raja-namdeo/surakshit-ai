# GitHub Integration Flow Documentation

This document describes the GitHub integration flow for the Surakshit AI Security Vulnerability Dashboard, allowing users to connect their GitHub repositories for vulnerability scanning.

## Overview

The GitHub integration feature enables users to:
- Authenticate with GitHub using OAuth
- Select a repository from their GitHub account
- Choose a specific branch or commit for scanning
- Initiate a vulnerability scan on the selected code
- View the scan results

## GitHub Integration Flow Diagram

```mermaid
flowchart TD
    A[User Clicks Connect with GitHub] --> B[Redirect to GitHub OAuth]
    B --> C[User Authorizes Application]
    C --> D[GitHub Redirects Back with Auth Code]
    D --> E[Backend Exchanges Code for Access Token]
    E --> F[Backend Fetches User Repositories]
    F --> G[Frontend Displays Repository List]
    G --> H[User Selects Repository]
    H --> I[Backend Fetches Repository Branches]
    I --> J[Frontend Displays Branch List]
    J --> K[User Selects Branch]
    K --> L[User Clicks Scan Selected Branch]
    L --> M[Backend Downloads Repository Code]
    M --> N[Backend Extracts Code]
    N --> O[Initiate Vulnerability Scan]
    O --> P[Return Scan ID to Frontend]
    P --> Q[Redirect to Scan Results Tab]
    Q --> R[Display Scan Progress/Results]
```

## OAuth Authentication Flow

```mermaid
sequenceDiagram
    participant User
    participant Frontend
    participant Backend
    participant GitHub
    
    User->>Frontend: Click "Connect with GitHub"
    Frontend->>Backend: Request GitHub authentication
    Backend->>Backend: Generate state parameter
    Backend->>User: Redirect to GitHub OAuth page
    User->>GitHub: Authorize application
    GitHub->>Backend: Redirect with authorization code
    Backend->>GitHub: Exchange code for access token
    GitHub->>Backend: Return access token
    Backend->>GitHub: Fetch user information
    GitHub->>Backend: Return user data
    Backend->>Backend: Store token and user info
    Backend->>Frontend: Redirect with authentication success
    Frontend->>User: Display authenticated state
```

## Repository Selection Flow

```mermaid
sequenceDiagram
    participant User
    participant GitHubIntegration
    participant Backend
    participant GitHub
    
    User->>GitHubIntegration: View connected repositories
    GitHubIntegration->>Backend: Request repositories
    Backend->>GitHub: Fetch user repositories
    GitHub->>Backend: Return repository list
    Backend->>GitHubIntegration: Return formatted repository data
    GitHubIntegration->>User: Display repository list
    
    User->>GitHubIntegration: Select repository
    GitHubIntegration->>Backend: Request branches for repository
    Backend->>GitHub: Fetch repository branches
    GitHub->>Backend: Return branch list
    Backend->>GitHubIntegration: Return formatted branch data
    GitHubIntegration->>User: Display branch list
    
    User->>GitHubIntegration: Select branch
    User->>GitHubIntegration: Click "Scan Selected Branch"
    GitHubIntegration->>Backend: Request scan of selected branch
    Backend->>GitHub: Download repository code
    GitHub->>Backend: Return repository code
    Backend->>Backend: Extract code and prepare for scanning
    Backend->>Backend: Initiate vulnerability scan
    Backend->>GitHubIntegration: Return scan ID
    GitHubIntegration->>User: Redirect to scan results
```

## Backend Processing Flow

```mermaid
flowchart TD
    A[Receive Scan Request] --> B[Validate Request]
    B --> C{Valid Request?}
    C -->|No| D[Return 400 Error]
    C -->|Yes| E[Fetch Repository Access Token]
    E --> F{Token Valid?}
    F -->|No| G[Return 401 Error]
    F -->|Yes| H[Download Repository as ZIP]
    H --> I{Download Successful?}
    I -->|No| J[Return Error Response]
    I -->|Yes| K[Create Extraction Directory]
    K --> L[Extract Repository Code]
    L --> M{Extraction Successful?}
    M -->|No| N[Clean Up Files]
    N --> O[Return Error Response]
    M -->|Yes| P[Initiate Vulnerability Scan]
    P --> Q[Return Success Response with Scan ID]
```

## Error Handling

The GitHub integration flow includes comprehensive error handling:

1. **Authentication Errors:**
   - Invalid or expired OAuth tokens
   - Revoked application access
   - Failed GitHub API requests

2. **Repository Access Errors:**
   - Repository not found
   - Insufficient permissions
   - Private repository access issues

3. **Branch Selection Errors:**
   - Branch not found
   - Empty repositories
   - Invalid branch names

4. **Download and Extraction Errors:**
   - Network failures during download
   - Invalid zip format
   - Extraction failures
   - Insufficient disk space

5. **Error Responses:**
   - Clear error messages are returned to the frontend
   - User-friendly error messages are displayed
   - Appropriate HTTP status codes are used

## Security Considerations

The GitHub integration implementation includes several security measures:

1. **OAuth Security:**
   - State parameter to prevent CSRF attacks
   - Secure token storage
   - Minimal scope requests (only 'repo' access)

2. **Token Management:**
   - Tokens stored securely (not in client-side storage)
   - Token validation before each GitHub API request
   - Proper error handling for expired tokens

3. **Repository Access:**
   - Only repositories the user has access to are available
   - Repository code is downloaded securely via GitHub API
   - Downloaded code is isolated in separate directories

4. **Resource Cleanup:**
   - Temporary files are removed after processing
   - Failed downloads are cleaned up automatically